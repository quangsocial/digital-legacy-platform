# ğŸ¯ HÆ¯á»šNG DáºªN TÃŒM SERVICE ROLE KEY - Tá»ªNG BÆ¯á»šC

## âš ï¸ Báº¡n Äang Nháº§m Key!

### Key Báº¡n ÄÃ£ Gá»­i:
1. âŒ `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (205 kÃ½ tá»±)
   - **Loáº¡i**: Supabase Anon Key
   - **Vai trÃ²**: public, client-side
   - **ÄÃ£ cÃ³ trong** `.env.local` rá»“i

2. âŒ `sb_publishable_AlUB4Pr-znEen0C5R5osEg_-FEvBbyj`
   - **Loáº¡i**: Stripe Publishable Key
   - **Vai trÃ²**: Thanh toÃ¡n Stripe
   - **KhÃ´ng liÃªn quan** Ä‘áº¿n Supabase

### Key Báº¡n Cáº¦N TÃŒM:
âœ… **Supabase Service Role Key** (JWT format, 700-800 kÃ½ tá»±)

---

## ğŸ“± Tá»ªNG BÆ¯á»šC TÃŒM KEY (5 PHÃšT)

### BÆ¯á»šC 1: Má»Ÿ TrÃ¬nh Duyá»‡t (Chrome/Edge/Firefox)
```
https://supabase.com/dashboard
```

### BÆ¯á»šC 2: ÄÄƒng Nháº­p Supabase
- Email: quangsocial@gmail.com (hoáº·c email báº¡n dÃ¹ng)
- Password: (máº­t kháº©u Supabase cá»§a báº¡n)

### BÆ¯á»šC 3: Chá»n Project
- Click vÃ o project **"digital-legacy-platform"**
- Hoáº·c project cÃ³ ID: `skkhbzrvzbsqebujlwcu`

### BÆ¯á»šC 4: VÃ o Settings
- Sidebar bÃªn trÃ¡i, click icon âš™ï¸ **"Settings"** (á»Ÿ cuá»‘i cÃ¹ng)
- Hoáº·c URL: https://supabase.com/dashboard/project/skkhbzrvzbsqebujlwcu/settings

### BÆ¯á»šC 5: Click Tab "API"
- Trong Settings menu, click **"API"**
- Hoáº·c URL: https://supabase.com/dashboard/project/skkhbzrvzbsqebujlwcu/settings/api

### BÆ¯á»šC 6: Scroll Xuá»‘ng TÃ¬m "Project API keys"
Báº¡n sáº½ tháº¥y 2 keys:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project API keys                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ ğŸ“Œ KEY 1: anon                              public ğŸ”“   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...   â”‚  â”‚
â”‚ â”‚                                        [ğŸ‘ï¸] [ğŸ“‹]   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â†‘ KEY NÃ€Y ÄÃƒ CÃ“ TRONG .env.local (NEXT_PUBLIC_...)     â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ ğŸ¯ KEY 2: service_role                     secret ğŸ”’    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢            â”‚  â”‚
â”‚ â”‚                                        [ğŸ‘ï¸] [ğŸ“‹]   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â†‘ COPY KEY NÃ€Y! (Click icon ğŸ“‹)                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### BÆ¯á»šC 7: Copy Service Role Key
**2 cÃ¡ch:**

#### CÃ¡ch A: Click Icon Copy ğŸ“‹ (KHUYÃŠN DÃ™NG)
1. TÃ¬m dÃ²ng cÃ³ chá»¯ **"service_role"** vÃ  icon ğŸ”’
2. BÃªn pháº£i key cÃ³ 2 icons: ğŸ‘ï¸ vÃ  ğŸ“‹
3. **Click icon ğŸ“‹ (copy)**
4. Key tá»± Ä‘á»™ng copy vÃ o clipboard
5. **KhÃ´ng cáº§n nhÃ¬n tháº¥y key**, nÃ³ Ä‘Ã£ copy rá»“i!

#### CÃ¡ch B: Click Icon Máº¯t ğŸ‘ï¸
1. Click icon **ğŸ‘ï¸ (eye)** Ä‘á»ƒ reveal key
2. Key sáº½ hiá»ƒn thá»‹: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...` (dÃ i láº¯m)
3. Click vÃ o key Ä‘á»ƒ select
4. **Ctrl+C** Ä‘á»ƒ copy
5. Hoáº·c triple-click Ä‘á»ƒ select toÃ n bá»™ dÃ²ng

### BÆ¯á»šC 8: Verify Key ÄÃ£ Copy
Má»Ÿ Notepad vÃ  **Ctrl+V** Ä‘á»ƒ paste. Kiá»ƒm tra:

âœ… **Key ÄÃšNG** náº¿u:
- Báº¯t Ä‘áº§u: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...`
- Äá»™ dÃ i: **700-800 kÃ½ tá»±**
- CÃ³ 3 pháº§n ngÄƒn cÃ¡ch bá»Ÿi `.`
- Pháº§n 2 decode ra cÃ³ `"role":"service_role"`

âŒ **Key SAI** náº¿u:
- DÆ°á»›i 300 kÃ½ tá»± â†’ ÄÃ³ lÃ  anon key
- Báº¯t Ä‘áº§u `sb_publishable_` â†’ ÄÃ³ lÃ  Stripe key
- KhÃ´ng pháº£i JWT format

---

## ğŸ”§ BÆ¯á»šC 9: Paste VÃ o .env.local

### A. Má»Ÿ File
- VS Code: `Ctrl+P` â†’ gÃµ `.env.local` â†’ Enter
- Hoáº·c má»Ÿ thá»§ cÃ´ng: `f:\DREAMDEV\digital-legacy-platform\.env.local`

### B. TÃ¬m DÃ²ng
```bash
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here
```

### C. Thay Tháº¿
```bash
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...(paste key vá»«a copy, 700+ kÃ½ tá»±)
```

### D. Save File
**Ctrl+S**

---

## ğŸ”„ BÆ¯á»šC 10: Khá»Ÿi Äá»™ng Láº¡i Server

### A. Dá»«ng Server Hiá»‡n Táº¡i
```bash
# Trong terminal Ä‘ang cháº¡y npm run dev:
# Nháº¥n Ctrl+C
```

### B. Cháº¡y Láº¡i Server
```bash
npm run dev
```

### C. Äá»£i Server Cháº¡y
```
âœ“ Ready in 3.2s
â—‹ Local:        http://localhost:3000
```

---

## âœ… BÆ¯á»šC 11: Test Táº¡o User

### A. Má»Ÿ Trang Admin Users
```
http://localhost:3000/admin/users
```

### B. Click NÃºt "ThÃªm ngÆ°á»i dÃ¹ng"

### C. Äiá»n Form
```
Email: test123@example.com
Password: Test123456
Há» tÃªn: Nguyá»…n VÄƒn Test
Role: user
```

### D. Click "Táº¡o tÃ i khoáº£n"

### E. Káº¿t Quáº£
âœ… **THÃ€NH CÃ”NG** náº¿u:
- Tháº¥y alert: "User created successfully"
- User xuáº¥t hiá»‡n trong báº£ng
- KhÃ´ng cÃ³ lá»—i trong console

âŒ **VáºªN Lá»–I** náº¿u:
- Tháº¥y: "User not allowed" â†’ Key váº«n sai, kiá»ƒm tra láº¡i
- Tháº¥y: "Unauthorized" â†’ ChÆ°a Ä‘Äƒng nháº­p admin
- Server crash â†’ Check terminal xem lá»—i gÃ¬

---

## ğŸ†˜ TROUBLESHOOTING

### Váº¥n Äá» 1: KhÃ´ng Tháº¥y Key service_role

**NguyÃªn nhÃ¢n cÃ³ thá»ƒ:**
1. ChÆ°a Ä‘Äƒng nháº­p Supabase
2. KhÃ´ng pháº£i Owner/Admin cá»§a project
3. Trang chÆ°a load xong

**Giáº£i phÃ¡p:**
- Äáº£m báº£o Ä‘Ã£ login: https://supabase.com/dashboard
- Kiá»ƒm tra vai trÃ²: Settings > Team > Xem role cá»§a báº¡n
- Refresh trang: **Ctrl+Shift+R**
- Thá»­ trÃ¬nh duyá»‡t khÃ¡c

### Váº¥n Äá» 2: Key Bá»‹ áº¨n, KhÃ´ng Copy ÄÆ°á»£c

**Giáº£i phÃ¡p:**
- DÃ¹ng icon ğŸ“‹ (copy) thay vÃ¬ ğŸ‘ï¸ (view)
- Thá»­ browser khÃ¡c (Chrome, Edge, Firefox)
- Disable extensions (ad blocker cÃ³ thá»ƒ cháº·n)

### Váº¥n Äá» 3: Copy Rá»“i NhÆ°ng Váº«n Lá»—i "User not allowed"

**Kiá»ƒm tra:**
1. Key cÃ³ Ä‘Ãºng 700-800 kÃ½ tá»± khÃ´ng?
   ```bash
   # Trong terminal PowerShell:
   (Get-Content .env.local | Select-String "SUPABASE_SERVICE_ROLE_KEY").Length
   # Pháº£i > 750
   ```

2. Key cÃ³ format JWT khÃ´ng?
   ```bash
   # Pháº£i cÃ³ 3 pháº§n ngÄƒn cÃ¡ch bá»Ÿi dáº¥u .
   # eyJhbGc...PHáº¦N1.eyJpc3M...PHáº¦N2.a1b2c3...PHáº¦N3
   ```

3. ÄÃ£ restart server chÆ°a?
   ```bash
   # Ctrl+C trong terminal
   npm run dev
   ```

### Váº¥n Äá» 4: Project KhÃ´ng CÃ³ service_role Key

**Cá»±c ká»³ hiáº¿m, nhÆ°ng náº¿u xáº£y ra:**

1. **Táº¡o láº¡i key:**
   - Settings > API > "Reset service_role key" button
   - Confirm reset
   - Copy key má»›i

2. **LiÃªn há»‡ Supabase Support:**
   - https://supabase.com/dashboard/support
   - MÃ´ táº£: "Project missing service_role key"

---

## ğŸ“Š So SÃ¡nh Visual

### Anon Key (200 kÃ½ tá»±) - ÄÃƒ CÃ“
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNra2hienJ2emJzcWVidWpsd2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjMyNjksImV4cCI6MjA3NjA5OTI2OX0.e5cZBssEwLEvekK2U3-9l0qGtgcYIz5ABLndgjtF-_E
```

### Service Role Key (700-800 kÃ½ tá»±) - Cáº¦N TÃŒM
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNra2hienJ2emJzcWVidWpsd2N1Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MDUyMzI2OSwiZXhwIjoyMDc2MDk5MjY5fQ.a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2g3h4i5j6k7l8m9n0o1p2q3r4s5t6u7v8w9x0y1z2a3b4c5d6e7f8g9h0i1j2k3l4m5n6o7p8q9r0s1t2u3v4w5x6y7z8a9b0c1d2e3f4g5h6i7j8k9l0m1n2o3p4q5r6s7t8u9v0w1x2y3z4a5b6c7d8e9f0g1h2i3j4k5l6m7n8o9p0q1r2s3t4u5v6w7x8y9z0a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2g3h4i5j6k7l8m9n0o1p2q3r4s5t6u7v8w9x0y1z2
```

**NhÃ¬n tháº¥y sá»± khÃ¡c biá»‡t chÆ°a?** Service role key **dÃ i gáº¥p 3-4 láº§n**!

---

## ğŸ” Báº£o Máº­t Service Role Key

**âš ï¸ KEY NÃ€Y CÃ“ QUYá»€N ADMIN TOÃ€N Bá»˜ DATABASE!**

### âœ… AN TOÃ€N:
- LÆ°u trong `.env.local` (file nÃ y trong .gitignore)
- Chá»‰ dÃ¹ng trong server-side code (`/api/` routes)
- KhÃ´ng bao giá» gá»­i qua client
- KhÃ´ng commit lÃªn Git

### âŒ NGUY HIá»‚M:
- Äá»ƒ trong code client-side
- Commit lÃªn GitHub public repo
- Share qua email, chat, Discord
- Äáº·t trong `NEXT_PUBLIC_*` variables
- Deploy khÃ´ng dÃ¹ng environment variables

**Náº¿u key bá»‹ lá»™:**
1. VÃ o Settings > API
2. Click "Reset service_role key"
3. Update láº¡i `.env.local`
4. Restart server

---

## âœ… Checklist HoÃ n ThÃ nh

- [ ] ÄÃ£ Ä‘Äƒng nháº­p Supabase Dashboard
- [ ] VÃ o Settings > API
- [ ] TÃ¬m tháº¥y 2 keys (anon vÃ  service_role)
- [ ] Copy key service_role (700-800 kÃ½ tá»±, JWT format)
- [ ] Paste vÃ o `.env.local` thay `your_supabase_service_role_key_here`
- [ ] Save file `.env.local`
- [ ] Restart server (`Ctrl+C` rá»“i `npm run dev`)
- [ ] Test táº¡o user thÃ nh cÃ´ng

---

## ğŸ“ Váº«n Cáº§n GiÃºp?

Náº¿u lÃ m theo 11 bÆ°á»›c trÃªn mÃ  váº«n khÃ´ng Ä‘Æ°á»£c:

1. **Screenshot trang API Settings** (che key Ä‘i)
2. **Copy ná»™i dung `.env.local`** (che key Ä‘i, chá»‰ Ä‘á»ƒ Ä‘á»™ dÃ i)
3. **Copy lá»—i trong terminal** khi táº¡o user
4. **Cho tÃ´i biáº¿t vai trÃ²** cá»§a báº¡n trong project (Owner/Admin/Member)

TÃ´i sáº½ troubleshoot cá»¥ thá»ƒ cho trÆ°á»ng há»£p cá»§a báº¡n!

---

**Thá»i gian Æ°á»›c tÃ­nh: 5 phÃºt**
**Äá»™ khÃ³: â­â­ (Trung bÃ¬nh - cáº§n tÃ¬m Ä‘Ãºng key)**
